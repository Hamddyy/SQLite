<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLite Data Management</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
    </style>
</head>
<body>
    <h1>SQLite Data Management</h1>

    <?php
    // الاتصال بقاعدة البيانات SQLite
    $pdo = new PDO("sqlite:my_database.db");

    // إنشاء الجدول إذا لم يكن موجودًا
    $pdo->exec("CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        email TEXT UNIQUE NOT NULL,
        age INTEGER
    )");

    // معالجة الطلبات
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        if (isset($_POST['action']) && $_POST['action'] === 'add') {
            // إضافة البيانات
            $name = $_POST['name'];
            $email = $_POST['email'];
            $age = $_POST['age'];

            try {
                $stmt = $pdo->prepare("INSERT INTO users (name, email, age) VALUES (:name, :email, :age)");
                $stmt->execute([
                    ':name' => $name,
                    ':email' => $email,
                    ':age' => $age
                ]);
                echo "<p style='color: green;'>Data added successfully!</p>";
            } catch (PDOException $e) {
                echo "<p style='color: red;'>Error: " . $e->getMessage() . "</p>";
            }
        } elseif (isset($_POST['action']) && $_POST['action'] === 'update') {
            // تعديل البيانات
            $id = $_POST['id'];
            $name = $_POST['name'];
            $email = $_POST['email'];
            $age = $_POST['age'];

            try {
                $stmt = $pdo->prepare("UPDATE users SET name = :name, email = :email, age = :age WHERE id = :id");
                $stmt->execute([
                    ':name' => $name,
                    ':email' => $email,
                    ':age' => $age,
                    ':id' => $id
                ]);
                echo "<p style='color: green;'>Data updated successfully!</p>";
            } catch (PDOException $e) {
                echo "<p style='color: red;'>Error: " . $e->getMessage() . "</p>";
            }
        }
    } elseif ($_SERVER['REQUEST_METHOD'] === 'GET' && isset($_GET['action']) && $_GET['action'] === 'delete') {
        // حذف البيانات
        $id = $_GET['id'];

        try {
            $stmt = $pdo->prepare("DELETE FROM users WHERE id = :id");
            $stmt->execute([':id' => $id]);
            echo "<p style='color: green;'>Data deleted successfully!</p>";
        } catch (PDOException $e) {
            echo "<p style='color: red;'>Error: " . $e->getMessage() . "</p>";
        }
    }

    // استرجاع البيانات لعرضها
    $stmt = $pdo->query("SELECT * FROM users");
    $users = $stmt->fetchAll(PDO::FETCH_ASSOC);
    ?>

    <!-- نموذج لإضافة البيانات -->
    <h2>Add User</h2>
    <form action="" method="POST">
        <input type="hidden" name="action" value="add">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <label for="age">Age:</label>
        <input type="number" id="age" name="age" required><br><br>

        <button type="submit">Add User</button>
    </form>

    <!-- عرض البيانات -->
    <h2>Users List</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Age</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($users as $user): ?>
                <tr>
                    <td><?= htmlspecialchars($user['id']) ?></td>
                    <td><?= htmlspecialchars($user['name']) ?></td>
                    <td><?= htmlspecialchars($user['email']) ?></td>
                    <td><?= htmlspecialchars($user['age']) ?></td>
                    <td class="action-buttons">
                        <!-- تعديل البيانات -->
                        <form action="" method="POST" style="display:inline;">
                            <input type="hidden" name="action" value="update">
                            <input type="hidden" name="id" value="<?= htmlspecialchars($user['id']) ?>">
                            <input type="text" name="name" value="<?= htmlspecialchars($user['name']) ?>" required>
                            <input type="email" name="email" value="<?= htmlspecialchars($user['email']) ?>" required>
                            <input type="number" name="age" value="<?= htmlspecialchars($user['age']) ?>" required>
                            <button type="submit">Update</button>
                        </form>

                        <!-- حذف البيانات -->
                        <a href="?action=delete&id=<?= htmlspecialchars($user['id']) ?>" style="color: red;">Delete</a>
                    </td>
                </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</body>
          </html>
